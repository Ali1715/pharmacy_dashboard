<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Agrega enlaces a Bootstrap y Chart.js (CDN) -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.flexmonster.com/flexmonster.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="https://cdn.flexmonster.com/demo.css">
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark bg-dark">
  <span class="navbar-brand mb-0 h1">Mi Dashboard</span>
</nav>

<!-- Cards Deslizables -->
<div class="container mt-4">
  <div class="card-deck">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Ventas Totales</h5>
        <p class="card-text">1020</p>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Crecimiento</h5>
        <p class="card-text">8% más que ayer</p>
      </div>
    </div>
    <!-- Agrega más cards según sea necesario -->
  </div>
</div>

<!-- Sección de Gráficos -->
<div class="container mt-4">
  <div class="row">
    <div class="col-md-6">
      <!-- Gráfico de Barra -->
      <canvas id="graficoBarra" width="400" height="400"></canvas>

    </div>
    <div class="col-md-6">
      <!-- Gráfico de Crecimiento Lineal -->
      <canvas id="graficoLineal"></canvas>
    </div>
  </div>
</div>

<!-- Sección de Lista de Ventas y Gráfico Pastel -->
<div class="container mt-4">
  <div class="row">
    <!-- Lista de Ventas -->
<div class="col-md-6">
    <div class="card">
      <div class="card-body">
        <h3 class="card-title">Listado de Ventas</h3>
        <ul class="list-group">
          <!-- Datos Estáticos para la Lista de Ventas -->
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Fecha 1</span>
            <span class="badge badge-primary badge-pill">$500</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Fecha 2</span>
            <span class="badge badge-primary badge-pill">$750</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>Fecha 3</span>
            <span class="badge badge-primary badge-pill">$600</span>
          </li>
          <!-- Fin de Datos Estáticos -->
  
          <!-- Itera sobre tus datos de ventas para mostrar cada venta -->
          {% for venta in ventas %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ venta.fecha }}</span>
              <span class="badge badge-primary badge-pill">${{ venta.monto }}</span>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
  
    <div class="col-md-6">
      <!-- Gráfico Pastel -->
      <canvas id="graficoPastel"></canvas>
    </div>
  </div>
  <div id="pivot-table-container" data-url="{% url 'pivot_data' %}"></div>
  <p>
    
  </p>
  <p>

  </p>
<div id="pivot-chart-container"></div>
<div id="pivotContainer"></div>
</div>

<!-- Configuración de los Gráficos con Chart.js -->
<script>
  // Datos de ejemplo para los gráficos (reemplázalos con tus propios datos)
  fetch('http://192.168.1.14:8000/api/productos')
    .then(response => response.json())
    .then(data => {
      // Configuración de gráfico de barra
      var datosBarra = {
            labels: data.map(item => item.id).slice(0, 10), // Tomar solo los primeros 3 productos como ejemplo,
            datasets: [{
                label: 'Cantidad de Stock ',
                data: data.map(item => item.cantidad_stock).slice(0, 10), // Tomar solo los primeros 3 productos como ejemplo,
                backgroundColor: 'rgba(255, 99, 132, 0.5)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        };
        
        var datosLineal = {
            labels: data.map(item => item.id),
            datasets: [{
                label: 'Cantidad en Stock por Producto',
                data: data.map(item => item.cantidad_stock),
                fill: false,
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2
            }]
        };

   // Configuración de gráfico de pastel (ejemplo)
   var datosPastel = {
            labels: data.map(item => item.nombre_producto).slice(2, 5), // Tomar solo los primeros 3 productos como ejemplo
            datasets: [{
                data: data.map(item => item.cantidad_stock).slice(2, 5), // Tomar solo los primeros 3 productos como ejemplo
                backgroundColor: ['rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)', 'rgba(255, 206, 86, 0.5)'],
                hoverBackgroundColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)']
            }]
        };

  // Configuración de los gráficos
  var opciones = {
    responsive: true,
    maintainAspectRatio: false
  };

  // Inicialización de los gráficos
  var ctxBarra = document.getElementById('graficoBarra').getContext('2d');
  new Chart(ctxBarra, {
    type: 'bar',
    data: datosBarra,
    options: opciones
  });

  var ctxLineal = document.getElementById('graficoLineal').getContext('2d');
  new Chart(ctxLineal, {
    type: 'line',
    data: datosLineal,
    options: opciones
  });

  var ctxPastel = document.getElementById('graficoPastel').getContext('2d');
  new Chart(ctxPastel, {
    type: 'doughnut',
    data: datosPastel,
    options: opciones
  });

})

    .catch(error => console.error('Error al obtener datos:', error));
</script>

<script>
  function processData(dataset) {
  var result = []
  dataset = [{
      label: 'Crecimiento Diario',
      data: [10, 15, 20, 18, 25],
      fill: false,
      borderColor: 'rgba(75, 192, 192, 1)',
      borderWidth: 2
    }]
  dataset.forEach(item => result.push(item.fields));
  return result;
}
$.ajax({
  url: $("#pivot-table-container").attr("data-url"),
  dataType: 'json',
  success: function(data) {
      new Flexmonster({
          container: "#pivot-table-container",
          componentFolder: "https://cdn.flexmonster.com/",
          width: "100%",
          height: 430,
          toolbar: true,
          report: {
              dataSource: {
                  type: "json",
                  data: processData(data),
                

              },
              slice: {
                measures: [
                {
                    uniqueName: 'Ventas',
                    aggregation: 'sum' // Puedes especificar la función de agregación que deseas, como 'sum', 'avg', etc.
                }
            ]
              }
              
          }
      });
     
    
  }
});
</script>
<!--<script>
  document.addEventListener('DOMContentLoaded', function () {
      // Hacer una solicitud a la API de Laravel
      fetch('http://192.168.0.7:8000/api/productos')
          .then(response => response.json())
          .then(data => {
              // Inicializar Flexmonster con los datos obtenidos
              new Flexmonster({
                  container: "pivotContainer",
                  toolbar: true,
                  licenseKey: "TU_CLAVE_DE_LICENCIA_AQUI" ,
                  report: {
                      dataSource: {
                          data: data,
                          type: 'json'
                      }
                  }
              });
          })
          .catch(error => console.error('Error al obtener datos:', error));
  });
</script>-->
</body>
</html>
